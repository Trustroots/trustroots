<!DOCTYPE html>
<html lang="en"
      ng-controller="AppController as app"
      {# Read more about `ng-csp`: https://docs.angularjs.org/api/ng/directive/ngCsp #}
      ng-csp>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title tr-page-title>{% if tribe %}{{ tribe.label | striptags }} - Trustroots Tribe{% else %}{{ title }}{% endif %}</title>
  <base href="/">
  <meta name="fragment" content="!">
  {% if process.env.NODE_ENV === 'development' %}
    {% for cssFile in cssFiles %}<link rel="stylesheet" href="/{{cssFile}}?c={{appSettings.commit}}">
    {% endfor %}
    <link rel="stylesheet" href="/dist/application.css?c={{appSettings.commit}}">
  {% endif %}
  {% if process.env.NODE_ENV === 'production' %}
    <link rel="stylesheet" href="/dist/application.min.css?c={{appSettings.commit}}">
  {% endif %}
  {# Prefech some domains that are used for user avatars and tribe images #}
  {# https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-DNS-Prefetch-Control #}
  <link rel="dns-prefetch" href="//graph.facebook.com">
  <link rel="dns-prefetch" href="//gravatar.com">
  <link rel="dns-prefetch" href="//ucarecdn.com">

  {# Generic / Android / Firefox #}
  <meta name="description" content="{{description}}">
  {% if googlePage !== '' %}<link rel="publisher" href="{{googlePage}}">{% endif %}
  <meta name="application-name" content="{{title}}">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#12b591">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" type="image/png" href="{{hostPort}}/modules/core/img/icons/android/512.png" sizes="512x512">
  <link rel="icon" type="image/png" href="{{hostPort}}/modules/core/img/icons/android/192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="{{hostPort}}/modules/core/img/icons/android/144.png" sizes="144x144">
  <link rel="icon" type="image/png" href="{{hostPort}}/modules/core/img/icons/android/96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="{{hostPort}}/modules/core/img/icons/android/72.png" sizes="72x72">
  <link rel="icon" type="image/png" href="{{hostPort}}/modules/core/img/icons/android/48.png" sizes="48x48">
  <link rel="icon shortcut" type="image/png" href="{{hostPort}}/modules/core/img/favicon@2x.png" sizes="32x32" id="favicon2x">
  <link rel="icon shortcut" type="image/png" href="{{hostPort}}/modules/core/img/favicon.png" sizes="16x16" id="favicon">

  {# Apple #}
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="{{hostPort}}/modules/core/img/icons/ios/Icon-76@2x.png">
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="{{hostPort}}/modules/core/img/icons/ios/Icon-60@2x.png">
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="{{hostPort}}/modules/core/img/icons/ios/Icon-76.png">
  <link rel="apple-touch-icon-precomposed" sizes="60x60" href="{{hostPort}}/modules/core/img/icons/ios/Icon-60.png">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="{{hostPort}}/modules/core/img/icons/ios/Icon-72@2x.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="{{hostPort}}/modules/core/img/icons/ios/Icon@2x.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="{{hostPort}}/modules/core/img/icons/ios/Icon-72.png">
  <link rel="apple-touch-icon" sizes="57x57" href="{{hostPort}}/modules/core/img/icons/ios/Icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  {# Facebook #}
  {% if facebookAppId !== '' %}<meta property="fb:app_id" content="{{facebookAppId}}">{% endif %}
  {% if facebookPage !== '' %}<meta property="article:publisher" content="{{facebookPage}}">{% endif %}
  {% if tribe %}
    <meta property="og:title" content="Join {{tribe.label|striptags|addslashes}} on Trustroots">
    <meta property="og:description" content="Join to meet, host and get hosted by Trustroots Tribe {{tribe.label|striptags|addslashes}}. Trustroots is a travellers' community for sharing, hosting and getting people together.">
    <meta property="og:url" content="{{hostPort}}/tribes/{{tribe.slug}}">
    {% if tribe.image_UUID %}
      {# https://developers.facebook.com/docs/sharing/best-practices#images #}
      <meta property="og:image" content="https://ucarecdn.com/{{tribe.image_UUID}}/-/progressive/yes/-/scale_crop/1200x630/center/-/quality/lightest/-/format/jpeg/-/overlay/b72e2604-e926-4e17-acbd-e37c0e1f5c73/50%25x50%25/center/{{tribe.slug}}.jpg">
    {% else %}
      <meta property="og:image" content="{{hostPort}}/modules/core/img/og_image.jpg">
    {% endif %}
  {% else %}
    <meta property="og:title" content="{{title}}">
    <meta property="og:description" content="{{description}}">
    <meta property="og:url" content="{{hostPort}}/">
    <meta property="og:image" content="{{hostPort}}/modules/core/img/og_image.jpg">
  {% endif %}
  <meta property="og:site_name" content="{{title}}">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="en_GB">

  {# Twitter #}
  {% if twitterUsername %}<meta name="twitter:site" content="{{twitterUsername}}">{% endif %}
  {% if tribe %}
    <meta name="twitter:title" content="Join {{tribe.label|striptags|addslashes}} on Trustroots">
    <meta name="twitter:description" content="Join to meet, host and get hosted by Trustroots Tribe {{tribe.label|striptags|addslashes}}. Trustroots is a travellers' community for sharing, hosting and getting people together.">
    <meta name="twitter:url" content="{{hostPort}}/tribes/{{tribe.slug}}">
    {% if tribe.image_UUID %}
      <meta name="twitter:image" content="https://ucarecdn.com/{{tribe.image_UUID}}/-/progressive/yes/-/scale_crop/1200x630/center/-/quality/lightest/-/format/jpeg/-/overlay/b72e2604-e926-4e17-acbd-e37c0e1f5c73/50%25x50%25/center/{{tribe.slug}}.jpg">
    {% else %}
      <meta name="twitter:image" content="{{hostPort}}/modules/core/img/og_image.jpg">
    {% endif %}
  {% else %}
    <meta name="twitter:title" content="{{title}}">
    <meta name="twitter:description" content="{{description}}">
    <meta name="twitter:url" content="{{hostPort}}/">
    <meta name="twitter:image" content="{{hostPort}}/modules/core/img/og_image.jpg">
  {% endif %}

  {# MS #}
  <meta name="msapplication-tap-highlight" content="no">
  <meta name="msapplication-TileColor" content="#FFFFFF">
  <meta name="msapplication-TileImage" content="{{hostPort}}/modules/core/img/icons/apple-touch-icon-144x144-precomposed.png">

  {# Google Analytics #}
  {% if googleAnalytics.enabled === true %}
  <script nonce="{{ nonce }}">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', '{{ googleAnalytics.code }}', 'auto');
  </script>
  <!-- https://www.trustroots.org/privacy -->
  {% endif %}

</head>
<body ng-cloak
      tr-window-blur="app.onWindowBlur()"
      tr-window-focus="app.onWindowFocus()"
      {% if siteAnnouncement.enabled && siteAnnouncement.message !== '' %}
        ng-class="{ 'is-site-announcement-visible': app.user && !app.isSiteAnnouncementClosed }"
      {% endif %}>

  <div id="tr-wrap">

    {% block header %}
      {% include 'partials/header.server.view.html' %}
    {% endblock %}

    {# Flash messages #}
    <mc-messages></mc-messages>

    {# Site wide notifications #}
    {# Enabled from `local.js` config #}
    {% if siteAnnouncement.enabled && siteAnnouncement.message !== '' %}
      <div class="alert alert-success site-announcement" ng-if="app.user && !app.isSiteAnnouncementClosed">
        {{siteAnnouncement.message}}
        <a class="close"
           ng-click="app.isSiteAnnouncementClosed = true;"
           data-dismiss="alert"
           aria-hidden="true">Ã—</a>
      </div>
    {% endif %}

    <article class="content" id="tr-main" role="main">
      {% block content %}{% endblock %}
    </article>

  </div>

  {% block footer %}
    {% include 'partials/footer.server.view.html' %}
  {% endblock %}

  {# Embedding constants coming from the backend #}
  <script nonce="{{ nonce }}">
    var user = {{ user | json | safe }},
        title = "{{title}}",
        settings = {{ appSettings | json | safe }},
        languages = {{ languages | json | safe }},
        {% if facebookAppId !== '' %}facebookAppId = "{{facebookAppId}}",{% endif %}
        env = "{{ env }}";
  </script>

  {% if process.env.NODE_ENV === 'production' %}
    <script src="/dist/application.min.js?c={{appSettings.commit}}"
            nonce="{{ nonce }}"></script>
    {% endif %}

  {% if process.env.NODE_ENV === 'development' %}
  {% for jsFile in jsFiles %}
    <script src="/{{jsFile}}?c={{appSettings.commit}}"
            nonce="{{ nonce }}"></script>
  {% endfor %}
  <script nonce="{{ nonce }}">
    // Make sure we get livereload from the same host (IP/localhost/...)
    document.write('\x3Cscript type="text/javascript" src="//' + window.location.hostname + ':35729/livereload.js">\x3C/script>');
  </script>
  {% endif %}

  <!--[if lt IE 9]>
  <div class="browsehappy text-center" ng-if="!app.hideBrowserhappy">
    <h2>That's an awfully old browser you're browsing with!</h2>
    <p class="lead">
      <br>
      You are using an old browser which we unfortunately do not support.
      <br><br>
      <a href="http://browsehappy.com" class="btn btn-primary btn-lg" role="button">Yes, upgrade my browser</a>
      <a ng-click="app.hideBrowserhappy=true" class="btn btn-default btn-lg" role="button">Nah, I'll take the risk!</a>
    </p>
  </div>
  <![endif]-->
</body>
</html>
