# Developer's guide to internationalization

We're using [`react-i18next`](https://react.i18next.com/) library for internationalization. They have [nice to read guides and documentation](https://react.i18next.com/guides/quick-start). The [`i18next`](https://www.i18next.com/) documentation is useful, too.

The translations are living in `/public/locales/{lng}/{namespace}.json`.

As a developer we don't need to provide translations. We need to wrap our component in `withNamespaces` or `<NamespacesConsumer>` from `react-i18next`. Then we can write the text in English and wrap it with `t()` function or [`<Trans>`](https://react.i18next.com/components/trans-component) component from `react-i18next`. The rest relies on extraction tools and people who wish to translate Trustroots.

We use natural keys. We wrap the English text as it is. In effect, in `/public/locales/eng/{namespace}.json`, the keys equal their (English) values.

Namespace name is equivalent to the file name in which the translation lives.

## Issues
So, we want to add a translation to a React component imported to Angular. This requires additional setup, not just `withNamespaces('namespace')(MyComponent)`.

For this purpose, use the `withNamespaces` exported from `./modules/core/client/utils/i18n-angular-load.js`, which behaves like `withNamespaces` from `react-i18next` and additionally takes care of this setup.

```jsx
// some-path-to/MyComponent.component.js

import React from 'react';
import PropTypes from 'prop-types';

/** Import for components imported to AngularJS */
import { withNamespaces } from '@/modules/core/client/utils/i18n-angular-load'; // notice the source
import { Trans } from 'react-i18next';

/** Use this for components, which are not imported to AngularJS */
// import { withNamespaces, Trans } from 'react-i18next';
// import '@/config/lib/i18n';

export function MyComponent({ t, ...otherProps }) { // export so we can test the unwrapped version
  return (
    <div>
      {t('Hello translation!')}
    </div>
    <div>
      <Trans>Another translation with <span>html</span>.</Trans>
    </div>
  )
}

// provide propTypes to MyComponent
MyComponent.propTypes = {
  prop1: PropTypes.string.isRequired,
  t: PropTypes.func.isRequired // has the t function
};

export default withNamespaces('my-namespace')(MyComponent);
```

Use the original `withNamespaces` from `react-i18next` for the components which don't get imported to Angular.

## Testing

react-i18next's `withNamespaces` or `<NamespacesConsumer>` wraps our components in several layers of React components. For this reason we want to export and [test the unwrapped component](https://react.i18next.com/misc/testing).

## Further topics

### Various namespaces in a single component

When we need to use multiple namespaces in a single component, we need to:
- Provide all used namespaces into `withNamespaces`: `withNamespaces(['defaultNamespace', 'otherNamespace'])`
- provide a non-default namespace to `t()`: `t(textStringNaturalKey, { ns: 'otherNamespace' })`

### Translation with variables

The translated string can contain variables.

```jsx
// unformatted
t('A translation string with {{amount}} words.', { amount: 6 })

// formatted
t('Translation created on {{ date, MMM D YYYY }}.', { date: new Date('2018-12-25') });
```

You can see available formattings in `./config/lib/i18n.js`. And you can add more there.

For the translations containing html, you can use [Trans](https://react.i18next.com/components/trans-component) component.

```jsx
// ... put all the necessary imports, too
import { Trans } from 'react-i18next';


// ...

  // Trans without variables
  <Trans>This is a translated string with a <a href="">link</a> inside.</Trans>

  // Trans with variables
  const variable = 'variable value';
  ...
  <Trans variable={variable}>Translated string with a <a href="">link</a> and {{ variable }}</Trans>

// ...
```
