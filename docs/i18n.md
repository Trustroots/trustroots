# Developer's guide to internationalization

_This is a draft._

We're using [`react-i18next`](https://react.i18next.com/) library for internationalization. They have [nice to read guides and documentation](https://react.i18next.com/guides/quick-start). The [`i18next`](https://www.i18next.com/) documentation is useful, too.

The translations are living in `/public/locales/{lng}/{namespace}.json`.

As a developer we don't need to provide translations. We need to wrap our component in `withNamespaces` or `<NamespacesConsumer>` from `react-i18next`. Then we can write the text in English and wrap it with `t()` function or [`<Trans>`](https://react.i18next.com/components/trans-component) component from `react-i18next`. The rest relies on extraction tools and people who wish to translate Trustroots.

We use natural keys. We wrap the English text as it is. In effect, in `/public/locales/eng/{namespace}.json`, the keys equal their (English) values.

Namespace name is equivalent to the file name in which the translation lives.

## Issues
When we wrap a React component in `withNamespaces`, its name changes. Angular import relies on the original name though. In order to make it work properly, we'll need to set the name again.


```jsx
// some-path-to/MyComponent.component.js

import React from 'react';
import PropTypes from 'prop-types';
import { withNamespaces, Trans } from 'react-i18next';
import '@/config/lib/i18n';

export function MyComponent({ t, ...otherProps }) { // export so we can test the unwrapped version
  return (
    <div>
      {t('Hello translation!')}
    </div>
    <div>
      <Trans>Another translation with <span>html</span>.</Trans>
    </div>
  )
}

// provide t and a namespace
const MyComponentHOC = withNamespaces('my-namespace')(MyComponent);

// set the name of MyComponentHOC to 'MyComponent' (only components imported to Angular)
Object.defineProperty(MyComponentHOC, 'name', { value: MyComponent.name });

// provide propTypes to both MyComponent and MyComponentHOC
MyComponentHOC.propTypes = {
  prop1: PropTypes.string.isRequired
};

MyComponent.propTypes = {
  ...MyComponentHOC.propTypes,
  t: PropTypes.func.isRequired // has also the t function
};

// The component can be used in Angular and in other React components now.
export default MyComponentHOC;
```

We'll write an utility function for this complicated wrapping.

Wrapping components which won't get imported to Angular is simpler. Just `export default withNamespaces('my-namespace')(MyComponent)`.

## Testing

react-i18next's `withNamespaces` or `<NamespacesConsumer>` wraps our components in several layers of React components. For this reason we want to export and [test the unwrapped component](https://react.i18next.com/misc/testing).

## Further topics
- provide a non-default namespace in `t(textStringNaturalKey, { ns: 'other-namespace' })`
- translation with variables
- translation with variables and formatting
