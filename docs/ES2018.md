# A guide for ES2018 migration

Write code in modern JavaScript!

This manual mostly applies to server-side code, but is largely valid for the whole application.

## eslint

When you create a new file or folder with ES2018, you need to tell linter about it.
Open `.eslintrc.js`. Add a path to the file or folder to `overrides[0].files`. _Note: If you write a React code, add the path to `overrides[1].files` instead._

## async functions and Promises
Completely replace `async` library with Promises + async/await functions. Use the promise versions of library methods. If only callback method is available, wrap it with [`util.promisify()`](https://nodejs.org/api/util.html#util_util_promisify_original).

Quick Promise basics: Promises are a way to organize asynchronous code.

When a function returns a Promise, it promises us, that it will give us some value in the future (resolve promise) or it will fail with error (reject promise). We can find out if we use `.then((value) => { /* do something with the value */ })` method.

Instead of using .then() we can wrap the promise returning method in async function and `await` the Promise resolution.

```js
// This is equivalent
function () {
  return promiseMethod1('a', 'b')
    .then((output1) => {
      console.log(output1);
      return output1;
    })
    .catch((error) => {
      console.error(error);
    });
}

async function () {
  try {
    const output1 = await promiseMethod1('a', 'b');
    console.log(output1);
    return output1;
  } catch (error) {
    console.error(error);
  }
}

```

TODO explain better or drop this and link some good article.

## Destructuring

Use [destructuring](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment) to avoid repetition.

```js
// before
var foo = {
  bar: bar
};

// now
const foo = {
  bar
};


// before
const foo = bar.foo;

// after
const { foo } = bar;
```

## Import

To load modules use `import` in client (React + webpack) code; use `require` in server (nodejs) code.

## var => let, const
Don't use `var`. If you're going to change a variable, declare it with `let`. Use `const` everywhere else. _Note: changing object property or array element doesn't change the original object. You should use const when defining the object.

## Arrow functions () => ()
Use [arrow functions](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions).

## Tests

Mocha likes Promises.
